# 计划：修复TTL方案数据保存和加载逻辑

## 问题分析

现有程序基本遵循用户描述的逻辑：
1. ✅ 切换引擎时正确保存旧引擎数据到项目文件
2. ✅ 切换引擎时加载新引擎数据到UI
3. ✅ 选择"无"引擎时禁用语音生成相关UI
4. ✅ 退出时保存当前引擎数据并写入磁盘

## 需要修复的问题

### 问题1：选择"无"引擎时的处理
当前逻辑：当PreviousEngineId是None时跳过保存
- 问题：如果用户在"无"引擎下有编辑过数据，这些数据会丢失
- 修复：保留当前逻辑（"无"引擎不需要保存），因为"无"引擎不应该有数据

### 问题2：确保数据正确保存
需要确认切换引擎时的保存逻辑是否正确工作

## 实施步骤

1. 确认EngineChanged中的保存逻辑
   - 当PreviousEngineId不是"无"时，保存旧引擎数据到项目文件内存
   - 当PreviousEngineId是"无"时，跳过保存

2. 确认加载逻辑
   - 加载新引擎的数据到UI
   - 如果没有数据则显示空

3. 确认退出时的保存逻辑
   - 保存当前引擎数据到项目文件内存
   - 将整个项目文件写入磁盘（所有引擎数据）

4. 验证语音生成面板在"无"引擎时的禁用状态
   - VoiceGenerationTabPage.Enabled = (currentEngine != null)
   - 确保切换到"无"时正确禁用

## 结论

现有代码逻辑基本正确，用户可以测试验证。
如果测试发现问题，请提供具体的问题描述。
