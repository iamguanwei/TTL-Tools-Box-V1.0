# 未完成迁移检查计划

## 一、发现的问题

### 1. 常量未迁移到Constants类

**问题描述**：Constants.cs中已定义了常量，但MainForm.cs中的原始常量未删除，引用也未迁移。

**MainForm.cs中需要迁移的常量**（约17个）：

| 常量名 | MainForm行号 | Constants.cs行号 | 引用次数 |
|--------|-------------|-----------------|---------|
| 整句_分割符号 | 37 | 16 | 2 |
| 半句_分割符号 | 42 | 21 | 2 |
| 分割_最小长度 | 47 | 26 | 3 |
| 对话_分割符号 | 52 | 31 | 2 |
| 存盘_分隔符 | 57 | 40 | 2 |
| 生成段落_分隔符 | 62 | 45 | 12 |
| 默认_角色标识 | 67 | 59 | 8 |
| 角色_文本分隔符 | 72 | 64 | 15 |
| 临时_工作目录 | 77 | 78 | 3 |
| 项目文件_扩展名 | 82 | 50 | 3 |
| Ffmpeg_文件夹 | 94 | 83 | 1 |
| Ffmpeg_文件 | 99 | 88 | 2 |
| TTL角色预览声音_文件夹 | 104 | 93 | 4 |
| TTL角色预览声音_文本 | 109 | 102 | 2 |
| 连接成功_验证间隔秒数 | 119 | 107 | 2 |
| 连接失败_重试间隔秒数 | 124 | 112 | 3 |
| 已丢失_标识后缀 | 129 | 69 | 6 |

### 2. TtlSchemeController中的重复常量

**问题描述**：TtlSchemeController.cs中也定义了相同的常量，应该使用Constants类。

| 常量名 | TtlSchemeController行号 | 说明 |
|--------|------------------------|------|
| 连接成功_验证间隔秒数 | 17 | 与Constants重复 |
| 连接失败_重试间隔秒数 | 18 | 与Constants重复 |
| None_Engine_Id | 19 | 与Constants重复 |

### 3. MainForm中的public常量

MainForm中有一个public常量`None_Engine_Id`（行134），需要检查是否有外部引用。

---

## 二、迁移计划

### 阶段1：Git签入（创建回滚点）
- 在开始迁移前先签入当前代码，以便有问题时回滚

### 阶段2：迁移MainForm中的常量引用
1. 将MainForm中所有常量引用改为`Constants.常量名`
2. 删除MainForm中的常量定义（保留`_软件版本`和`_Setting_Key_LastProjectFolder`这两个私有常量）

### 阶段3：迁移TtlSchemeController中的常量引用
1. 添加`using GW.TTLtoolsBox.WinFormUi.Helper;`
2. 将TtlSchemeController中的常量引用改为`Constants.常量名`
3. 删除TtlSchemeController中的重复常量定义

### 阶段4：验证编译
- 确保所有修改后代码能正常编译

---

## 三、预计修改量

| 文件 | 修改类型 | 预计行数 |
|------|---------|---------|
| MainForm.cs | 引用替换 | 约70处 |
| MainForm.cs | 删除常量定义 | 约100行 |
| TtlSchemeController.cs | 引用替换 | 约3处 |
| TtlSchemeController.cs | 删除常量定义 | 约5行 |

---

## 四、执行步骤

1. **签入当前代码**：`git add . && git commit -m "重构前备份：TTL方案控制器迁移完成"`
2. **修改MainForm.cs**：
   - 添加`using static GW.TTLtoolsBox.WinFormUi.Helper.Constants;`
   - 替换所有常量引用
   - 删除冗余常量定义
3. **修改TtlSchemeController.cs**：
   - 添加`using static GW.TTLtoolsBox.WinFormUi.Helper.Constants;`
   - 替换常量引用
   - 删除冗余常量定义
4. **验证编译**：确保无错误
